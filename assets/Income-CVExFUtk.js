import{s as de}from"./index-BxmazQUx.js";import{s as ce}from"./index-CmCuRXjW.js";import{B as w,s as ve,a as me,b as pe,c as fe,d as be,e as ye,f as _e,g as ge}from"./BaseServices-C7MaePp3.js";import{s as we}from"./index-BzA8Gx5M.js";import{s as he,a as ke}from"./index-BFNgdO1s.js";import{M as xe}from"./MyWalletService-D6Z2Osts.js";import{I as Ie}from"./IncomeCategoryService-Yg7oeUWD.js";import{b as n,d as De,f as Ce,o as v,c as m,a as i,e as a,g as s,F as Se,h as V,t as L,j as f,k as Ve}from"./index-CqvKQK5V.js";import"./index-BxPp5uvz.js";import"./axios-BimPEqV4.js";var Ue={name:"Calendar",extends:we,mounted:function(){console.warn("Deprecated since v4. Use DatePicker component instead.")}};const h="http://backend.keuangan.net/api/incomes",k={getData:async()=>await w.getData(h),create:async c=>await w.create(c,h),update:async(c,r)=>await w.update(c,r,h),delete:async c=>await w.delete(c,h),bulkDelete:async c=>await w.bulkDelete(c,`${h}/bulk-delete`),import:async c=>await w.import(c,`${h}/import`)},$e={class:"card flex items-center justify-between py-3"},Pe=i("h2",{class:"font-semibold text-2xl"},"Income",-1),Le={class:"card"},Ne={class:"flex flex-wrap gap-2 items-center justify-between"},qe=i("h4",{class:"m-0"},"Manage Incomes",-1),Fe=i("i",{class:"pi pi-search"},null,-1),Me={class:"flex flex-col gap-6"},Te=i("label",{for:"date",class:"block font-bold mb-3"},"Date",-1),Be={key:0,class:"text-red-500"},Ae=i("label",{for:"name",class:"block font-bold mb-3"},"Description",-1),Re={key:0,class:"text-red-500"},Ee=i("label",{for:"category",class:"block font-bold mb-3"},"Category",-1),je={key:0,class:"text-red-500"},We=i("label",{for:"wallet",class:"block font-bold mb-3"},"Wallet",-1),Oe={key:0,class:"text-red-500"},Ye=i("label",{for:"price",class:"block font-bold mb-3"},"Amount",-1),ze={key:0,class:"text-red-500"},He={class:"flex items-center gap-4"},Ke=i("i",{class:"pi pi-exclamation-triangle !text-3xl"},null,-1),Ge={key:0},Je={class:"flex items-center gap-4"},Qe=i("i",{class:"pi pi-exclamation-triangle !text-3xl"},null,-1),Xe={key:0},rl={__name:"Income",setup(c){const r=n(),U=n(),$=n(),D=n(!1),N=async()=>{try{D.value=!0,r.value=await k.getData()}catch(t){console.error(t)}finally{D.value=!1}},A=async()=>{try{D.value=!0,U.value=await Ie.getData().then(t=>t.map(l=>({label:l.name,value:l}))),$.value=await xe.getData().then(t=>t.map(l=>({label:l.wallet.name,value:l})))}catch(t){console.error(t)}finally{D.value=!1}};De(()=>{A(),N()});const b=Ce(),q=n(),y=n(!1),C=n(!1),x=n(!1),I=n(!1),e=n({}),F=n(null),_=n(),P=n({global:{value:null,matchMode:Ve.CONTAINS}}),u=n(!1);function R(t){F.value=t.files[0]}function E(t){if(t)return t.toLocaleString("id-ID",{style:"currency",currency:"IDR"})}function j(t){if(t)return new Date(t).toLocaleDateString("en-US",{month:"long",day:"2-digit",year:"numeric"})}function M(t){b.add({severity:"error",summary:"Error",detail:t,life:3e3})}function W(){e.value={},u.value=!1,y.value=!0}function O(){y.value=!1,u.value=!1}async function Y(){var t;if(u.value=!0,(t=e==null?void 0:e.value.description)!=null&&t.trim()&&(e!=null&&e.value.amount)){if(e.value.id){const l=await k.update(e.value.id,{date:e.value.date,description:e.value.description,amount:e.value.amount,category_id:e.value.category.value.id,user_wallet_id:e.value.wallet.value.id});if(l.status===422){M(l.data.message);return}r.value[G(e.value.id)]={id:e.value.id,date:e.value.date,description:e.value.description,amount:e.value.amount,user_wallet_id:e.value.wallet.value.id,category:{...e.value.category.value},wallet:{...e.value.wallet.value.wallet}},b.add({severity:"success",summary:"Successful",detail:"Income Updated",life:3e3})}else{const l=await k.create({date:e.value.date,description:e.value.description,amount:e.value.amount,category_id:e.value.category.value.id,user_wallet_id:e.value.wallet.value.id});if(l.status===422){M(l.data.message);return}r.value.unshift({id:l.data.id,date:e.value.date,description:e.value.description,amount:e.value.amount,user_wallet_id:e.value.wallet.value.id,category:{...e.value.category.value},wallet:{...e.value.wallet.value.wallet}}),b.add({severity:"success",summary:"Successful",detail:"Income Created",life:3e3})}y.value=!1,e.value={}}}function z(t){e.value={id:t.id,date:new Date(t.date),description:t.description,amount:t.amount,category:U.value.find(l=>l.value.id===t.category.id),wallet:$.value.find(l=>l.value.id===t.user_wallet_id)},y.value=!0}function H(t){e.value=t,x.value=!0}function K(){k.delete(e.value.id),r.value=r.value.filter(t=>t.id!==e.value.id),x.value=!1,e.value={},b.add({severity:"success",summary:"Successful",detail:"Income Deleted",life:3e3})}function G(t){let l=-1;for(let g=0;g<r.value.length;g++)if(r.value[g].id===t){l=g;break}return l}function J(){q.value.exportCSV()}function Q(){k.import({file:F.value}).then(()=>{N()}).catch(t=>{console.error(t)}),C.value=!1,b.add({severity:"info",summary:"Success",detail:"File Uploaded",life:3e3})}function X(){I.value=!0}function Z(){let t=_.value.map(l=>l.id);k.bulkDelete({ids:t}),r.value=r.value.filter(l=>!t.includes(l.id)),I.value=!1,_.value=null,b.add({severity:"success",summary:"Successful",detail:"Incomes Deleted",life:3e3})}const ee=n([{label:"Dashboard",to:"/"},{label:"Data"},{label:"Income"}]),le=n({icon:"pi pi-home",to:"/"});return(t,l)=>{const g=ve,d=he,te=me,ae=fe,T=ke,oe=be,p=ye,ie=pe,ne=Ue,B=_e,se=ge,S=ce,ue=de;return v(),m(Se,null,[i("div",$e,[Pe,a(g,{home:le.value,model:ee.value},null,8,["home","model"])]),i("div",null,[i("div",Le,[a(te,{class:"mb-6"},{start:s(()=>[a(d,{label:"New",icon:"pi pi-plus",severity:"secondary",class:"mr-2",onClick:W}),a(d,{label:"Delete",icon:"pi pi-trash",severity:"secondary",onClick:X,disabled:!_.value||!_.value.length},null,8,["disabled"])]),end:s(()=>[a(d,{label:"Import",icon:"pi pi-download",severity:"secondary mx-2",onClick:l[0]||(l[0]=o=>C.value=!0)}),a(d,{label:"Export",icon:"pi pi-upload",severity:"secondary",onClick:l[1]||(l[1]=o=>J(o))})]),_:1}),a(ie,{ref_key:"dt",ref:q,selection:_.value,"onUpdate:selection":l[3]||(l[3]=o=>_.value=o),value:r.value,dataKey:"id",paginator:!0,rows:10,filters:P.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} incomes"},{header:s(()=>[i("div",Ne,[qe,a(oe,null,{default:s(()=>[a(ae,null,{default:s(()=>[Fe]),_:1}),a(T,{modelValue:P.value.global.value,"onUpdate:modelValue":l[2]||(l[2]=o=>P.value.global.value=o),placeholder:"Search..."},null,8,["modelValue"])]),_:1})])]),default:s(()=>[a(p,{selectionMode:"multiple",style:{width:"3rem"},exportable:!1}),a(p,{field:"date",header:"Date",sortable:""},{body:s(o=>[V(L(j(o.data.date)),1)]),_:1}),a(p,{field:"description",header:"Description",sortable:""}),a(p,{field:"category.name",header:"Category",sortable:""}),a(p,{field:"wallet.name",header:"Wallet",sortable:""}),a(p,{field:"amount",header:"Amount",sortable:""},{body:s(o=>[V(L(E(o.data.amount)),1)]),_:1}),a(p,{exportable:!1,style:{"min-width":"12rem"}},{body:s(o=>[a(d,{icon:"pi pi-pencil",outlined:"",rounded:"",class:"mr-2",onClick:re=>z(o.data)},null,8,["onClick"]),a(d,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:re=>H(o.data)},null,8,["onClick"])]),_:1})]),_:1},8,["selection","value","filters"])]),a(S,{visible:y.value,"onUpdate:visible":l[9]||(l[9]=o=>y.value=o),style:{width:"450px"},header:"Income Details",modal:!0},{footer:s(()=>[a(d,{label:"Cancel",icon:"pi pi-times",text:"",onClick:O}),a(d,{label:"Save",icon:"pi pi-check",onClick:Y})]),default:s(()=>[i("div",Me,[i("div",null,[Te,a(ne,{id:"date",modelValue:e.value.date,"onUpdate:modelValue":l[4]||(l[4]=o=>e.value.date=o),invalid:u.value&&!e.value.date,required:"true",showIcon:"",fluid:""},null,8,["modelValue","invalid"]),u.value&&!e.value.date?(v(),m("small",Be,"date is required.")):f("",!0)]),i("div",null,[Ae,a(T,{id:"description",modelValue:e.value.description,"onUpdate:modelValue":l[5]||(l[5]=o=>e.value.description=o),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:u.value&&!e.value.description,fluid:""},null,8,["modelValue","invalid"]),u.value&&!e.value.description?(v(),m("small",Re,"description is required.")):f("",!0)]),i("div",null,[Ee,a(B,{id:"category",modelValue:e.value.category,"onUpdate:modelValue":l[6]||(l[6]=o=>e.value.category=o),options:U.value,optionLabel:"label",placeholder:"Select a Category",required:"true",invalid:u.value&&!e.value.category,fluid:""},null,8,["modelValue","options","invalid"]),u.value&&!e.value.category?(v(),m("small",je,"category is required.")):f("",!0)]),i("div",null,[We,a(B,{id:"wallet",modelValue:e.value.wallet,"onUpdate:modelValue":l[7]||(l[7]=o=>e.value.wallet=o),options:$.value,optionLabel:"label",placeholder:"Select a wallet source",required:"true",invalid:u.value&&!e.value.wallet,fluid:""},null,8,["modelValue","options","invalid"]),u.value&&!e.value.wallet?(v(),m("small",Oe,"wallet is required.")):f("",!0)]),i("div",null,[Ye,a(se,{id:"amount",modelValue:e.value.amount,"onUpdate:modelValue":l[8]||(l[8]=o=>e.value.amount=o),modelModifiers:{trim:!0},required:"true",invalid:u.value&&!e.value.amount,fluid:""},null,8,["modelValue","invalid"]),u.value&&!e.value.amount?(v(),m("small",ze,"amount is required.")):f("",!0)])])]),_:1},8,["visible"]),a(S,{visible:C.value,"onUpdate:visible":l[10]||(l[10]=o=>C.value=o),style:{width:"450px"},header:"Import Income",modal:!0},{default:s(()=>[a(ue,{name:"file",onUploader:Q,onSelect:R,maxFileSize:1e6,customUpload:""})]),_:1},8,["visible"]),a(S,{visible:x.value,"onUpdate:visible":l[12]||(l[12]=o=>x.value=o),style:{width:"450px"},header:"Confirm",modal:!0},{footer:s(()=>[a(d,{label:"No",icon:"pi pi-times",text:"",onClick:l[11]||(l[11]=o=>x.value=!1)}),a(d,{label:"Yes",icon:"pi pi-check",onClick:K})]),default:s(()=>[i("div",He,[Ke,e.value?(v(),m("span",Ge,[V("Are you sure you want to delete "),i("b",null,L(e.value.description),1),V("?")])):f("",!0)])]),_:1},8,["visible"]),a(S,{visible:I.value,"onUpdate:visible":l[14]||(l[14]=o=>I.value=o),style:{width:"450px"},header:"Confirm",modal:!0},{footer:s(()=>[a(d,{label:"No",icon:"pi pi-times",text:"",onClick:l[13]||(l[13]=o=>I.value=!1)}),a(d,{label:"Yes",icon:"pi pi-check",text:"",onClick:Z})]),default:s(()=>[i("div",Je,[Qe,e.value?(v(),m("span",Xe,"Are you sure you want to delete the selected Incomes?")):f("",!0)])]),_:1},8,["visible"])])],64)}}};export{rl as default};

import{s as re}from"./index-BxmazQUx.js";import{s as de}from"./index-CmCuRXjW.js";import{B as x,s as ce,a as ve,b as pe,c as me,d as fe,e as be,f as ye,g as _e}from"./BaseServices-C7MaePp3.js";import{s as ge,a as xe}from"./index-BFNgdO1s.js";import{M as we}from"./MyWalletService-D6Z2Osts.js";import{E as he}from"./ExpenseCategoryService-CqJzwV_N.js";import{b as s,d as ke,f as De,o as v,c as p,a as i,e as a,g as n,F as Ce,h as V,t as L,i as Ee,j as f,k as Se}from"./index-CqvKQK5V.js";import{s as Ve}from"./index-BzA8Gx5M.js";import"./index-BxPp5uvz.js";import"./axios-BimPEqV4.js";const w="http://backend.keuangan.net/api/spendings",h={getData:async()=>await x.getData(w),create:async c=>await x.create(c,w),update:async(c,r)=>await x.update(c,r,w),delete:async c=>await x.delete(c,w),bulkDelete:async c=>await x.bulkDelete(c,`${w}/bulk-delete`),import:async c=>await x.import(c,`${w}/import`)},Ue={class:"card flex items-center justify-between py-3"},$e=i("h2",{class:"font-semibold text-2xl"},"Expense",-1),Ie={class:"card"},Le={class:"flex flex-wrap gap-2 items-center justify-between"},Ne=i("h4",{class:"m-0"},"Manage Expenses",-1),Pe=i("i",{class:"pi pi-search"},null,-1),qe={class:"flex flex-col gap-6"},Fe=i("label",{for:"date",class:"block font-bold mb-3"},"Date",-1),Me={key:0,class:"text-red-500"},Te=i("label",{for:"name",class:"block font-bold mb-3"},"Description",-1),Be={key:0,class:"text-red-500"},Ae=i("label",{for:"category",class:"block font-bold mb-3"},"Category",-1),Re={key:0,class:"text-red-500"},je=i("label",{for:"wallet",class:"block font-bold mb-3"},"Wallet",-1),We={key:0,class:"text-red-500"},Oe=i("label",{for:"price",class:"block font-bold mb-3"},"Amount",-1),Ye={key:0,class:"text-red-500"},ze={class:"flex items-center gap-4"},He=i("i",{class:"pi pi-exclamation-triangle !text-3xl"},null,-1),Ke={key:0},Ge={class:"flex items-center gap-4"},Je=i("i",{class:"pi pi-exclamation-triangle !text-3xl"},null,-1),Qe={key:0},ul={__name:"Expense",setup(c){const r=s(),U=s(),$=s(),C=s(!1),N=async()=>{try{C.value=!0,r.value=await h.getData()}catch(t){console.error(t)}finally{C.value=!1}},B=async()=>{try{C.value=!0,U.value=await he.getData().then(t=>t.map(l=>({label:l.name,value:l}))),$.value=await we.getData().then(t=>t.map(l=>({label:l.wallet.name,value:l})))}catch(t){console.error(t)}finally{C.value=!1}};ke(()=>{B(),N()});const b=De(),P=s(),y=s(!1),E=s(!1),k=s(!1),D=s(!1),e=s({}),q=s(null),_=s(),I=s({global:{value:null,matchMode:Se.CONTAINS}}),u=s(!1);function A(t){q.value=t.files[0]}function R(t){if(t)return t.toLocaleString("id-ID",{style:"currency",currency:"IDR"})}function j(t){if(t)return new Date(t).toLocaleDateString("en-US",{month:"long",day:"2-digit",year:"numeric"})}function F(t){b.add({severity:"error",summary:"Error",detail:t,life:3e3})}function W(){e.value={},u.value=!1,y.value=!0}function O(){y.value=!1,u.value=!1}async function Y(){var t;if(u.value=!0,(t=e==null?void 0:e.value.description)!=null&&t.trim()&&(e!=null&&e.value.amount)){if(e.value.id){const l=await h.update(e.value.id,{date:e.value.date,description:e.value.description,amount:e.value.amount,category_id:e.value.category.value.id,user_wallet_id:e.value.wallet.value.id});if(l.status===422){F(l.data.message);return}r.value[G(e.value.id)]={id:e.value.id,date:e.value.date,description:e.value.description,amount:e.value.amount,user_wallet_id:e.value.wallet.value.id,category:{...e.value.category.value},wallet:{...e.value.wallet.value.wallet}},b.add({severity:"success",summary:"Successful",detail:"Expense Updated",life:3e3})}else{const l=await h.create({date:e.value.date,description:e.value.description,amount:e.value.amount,category_id:e.value.category.value.id,user_wallet_id:e.value.wallet.value.id});if(l.status===422){F(l.data.message);return}r.value.unshift({id:l.data.id,date:e.value.date,description:e.value.description,amount:e.value.amount,user_wallet_id:e.value.wallet.value.id,category:{...e.value.category.value},wallet:{...e.value.wallet.value.wallet}}),b.add({severity:"success",summary:"Successful",detail:"Expense Created",life:3e3})}y.value=!1,e.value={}}}function z(t){e.value={id:t.id,date:new Date(t.date),description:t.description,amount:t.amount,category:U.value.find(l=>l.value.id===t.category.id),wallet:$.value.find(l=>l.value.id===t.user_wallet_id)},y.value=!0}function H(t){e.value=t,k.value=!0}function K(){h.delete(e.value.id),r.value=r.value.filter(t=>t.id!==e.value.id),k.value=!1,e.value={},b.add({severity:"success",summary:"Successful",detail:"Expense Deleted",life:3e3})}function G(t){let l=-1;for(let g=0;g<r.value.length;g++)if(r.value[g].id===t){l=g;break}return l}function J(){P.value.exportCSV()}function Q(){h.import({file:q.value}).then(()=>{N()}).catch(t=>{console.error(t)}),E.value=!1,b.add({severity:"info",summary:"Success",detail:"File Uploaded",life:3e3})}function X(){D.value=!0}function Z(){let t=_.value.map(l=>l.id);h.bulkDelete({ids:t}),r.value=r.value.filter(l=>!t.includes(l.id)),D.value=!1,_.value=null,b.add({severity:"success",summary:"Successful",detail:"Expenses Deleted",life:3e3})}const ee=s([{label:"Dashboard",to:"/"},{label:"Data"},{label:"Expense"}]),le=s({icon:"pi pi-home",to:"/"});return(t,l)=>{const g=ce,d=ge,te=ve,ae=me,M=xe,oe=fe,m=be,ie=pe,T=ye,se=_e,S=de,ne=re;return v(),p(Ce,null,[i("div",Ue,[$e,a(g,{home:le.value,model:ee.value},null,8,["home","model"])]),i("div",null,[i("div",Ie,[a(te,{class:"mb-6"},{start:n(()=>[a(d,{label:"New",icon:"pi pi-plus",severity:"secondary",class:"mr-2",onClick:W}),a(d,{label:"Delete",icon:"pi pi-trash",severity:"secondary",onClick:X,disabled:!_.value||!_.value.length},null,8,["disabled"])]),end:n(()=>[a(d,{label:"Import",icon:"pi pi-download",severity:"secondary mx-2",onClick:l[0]||(l[0]=o=>E.value=!0)}),a(d,{label:"Export",icon:"pi pi-upload",severity:"secondary",onClick:l[1]||(l[1]=o=>J(o))})]),_:1}),a(ie,{ref_key:"dt",ref:P,selection:_.value,"onUpdate:selection":l[3]||(l[3]=o=>_.value=o),value:r.value,dataKey:"id",paginator:!0,rows:10,filters:I.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} expenses"},{header:n(()=>[i("div",Le,[Ne,a(oe,null,{default:n(()=>[a(ae,null,{default:n(()=>[Pe]),_:1}),a(M,{modelValue:I.value.global.value,"onUpdate:modelValue":l[2]||(l[2]=o=>I.value.global.value=o),placeholder:"Search..."},null,8,["modelValue"])]),_:1})])]),default:n(()=>[a(m,{selectionMode:"multiple",style:{width:"3rem"},exportable:!1}),a(m,{field:"date",header:"Date",sortable:""},{body:n(o=>[V(L(j(o.data.date)),1)]),_:1}),a(m,{field:"description",header:"Description",sortable:""}),a(m,{field:"category.name",header:"Category",sortable:""}),a(m,{field:"wallet.name",header:"Wallet",sortable:""}),a(m,{field:"amount",header:"Amount",sortable:""},{body:n(o=>[V(L(R(o.data.amount)),1)]),_:1}),a(m,{exportable:!1,style:{"min-width":"12rem"}},{body:n(o=>[a(d,{icon:"pi pi-pencil",outlined:"",rounded:"",class:"mr-2",onClick:ue=>z(o.data)},null,8,["onClick"]),a(d,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:ue=>H(o.data)},null,8,["onClick"])]),_:1})]),_:1},8,["selection","value","filters"])]),a(S,{visible:y.value,"onUpdate:visible":l[9]||(l[9]=o=>y.value=o),style:{width:"450px"},header:"Expense Details",modal:!0},{footer:n(()=>[a(d,{label:"Cancel",icon:"pi pi-times",text:"",onClick:O}),a(d,{label:"Save",icon:"pi pi-check",onClick:Y})]),default:n(()=>[i("div",qe,[i("div",null,[Fe,a(Ee(Ve),{id:"date",modelValue:e.value.date,"onUpdate:modelValue":l[4]||(l[4]=o=>e.value.date=o),invalid:u.value&&!e.value.date,required:"true",showIcon:"",fluid:""},null,8,["modelValue","invalid"]),u.value&&!e.value.date?(v(),p("small",Me,"date is required.")):f("",!0)]),i("div",null,[Te,a(M,{id:"description",modelValue:e.value.description,"onUpdate:modelValue":l[5]||(l[5]=o=>e.value.description=o),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:u.value&&!e.value.description,fluid:""},null,8,["modelValue","invalid"]),u.value&&!e.value.description?(v(),p("small",Be,"description is required.")):f("",!0)]),i("div",null,[Ae,a(T,{id:"category",modelValue:e.value.category,"onUpdate:modelValue":l[6]||(l[6]=o=>e.value.category=o),options:U.value,optionLabel:"label",placeholder:"Select a Category",required:"true",invalid:u.value&&!e.value.category,fluid:""},null,8,["modelValue","options","invalid"]),u.value&&!e.value.category?(v(),p("small",Re,"category is required.")):f("",!0)]),i("div",null,[je,a(T,{id:"wallet",modelValue:e.value.wallet,"onUpdate:modelValue":l[7]||(l[7]=o=>e.value.wallet=o),options:$.value,optionLabel:"label",placeholder:"Select a wallet source",required:"true",invalid:u.value&&!e.value.wallet,fluid:""},null,8,["modelValue","options","invalid"]),u.value&&!e.value.wallet?(v(),p("small",We,"wallet is required.")):f("",!0)]),i("div",null,[Oe,a(se,{id:"amount",modelValue:e.value.amount,"onUpdate:modelValue":l[8]||(l[8]=o=>e.value.amount=o),modelModifiers:{trim:!0},required:"true",invalid:u.value&&!e.value.amount,fluid:""},null,8,["modelValue","invalid"]),u.value&&!e.value.amount?(v(),p("small",Ye,"amount is required.")):f("",!0)])])]),_:1},8,["visible"]),a(S,{visible:E.value,"onUpdate:visible":l[10]||(l[10]=o=>E.value=o),style:{width:"450px"},header:"Import Expense",modal:!0},{default:n(()=>[a(ne,{name:"file",onUploader:Q,onSelect:A,maxFileSize:1e6,customUpload:""})]),_:1},8,["visible"]),a(S,{visible:k.value,"onUpdate:visible":l[12]||(l[12]=o=>k.value=o),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[a(d,{label:"No",icon:"pi pi-times",text:"",onClick:l[11]||(l[11]=o=>k.value=!1)}),a(d,{label:"Yes",icon:"pi pi-check",onClick:K})]),default:n(()=>[i("div",ze,[He,e.value?(v(),p("span",Ke,[V("Are you sure you want to delete "),i("b",null,L(e.value.description),1),V("?")])):f("",!0)])]),_:1},8,["visible"]),a(S,{visible:D.value,"onUpdate:visible":l[14]||(l[14]=o=>D.value=o),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[a(d,{label:"No",icon:"pi pi-times",text:"",onClick:l[13]||(l[13]=o=>D.value=!1)}),a(d,{label:"Yes",icon:"pi pi-check",text:"",onClick:Z})]),default:n(()=>[i("div",Ge,[Je,e.value?(v(),p("span",Qe,"Are you sure you want to delete the selected expenses?")):f("",!0)])]),_:1},8,["visible"])])],64)}}};export{ul as default};
